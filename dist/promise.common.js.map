{"version":3,"file":"promise.common.js","sources":["../src/proto/finally.js","../src/proto/timeout.js","../src/util.js","../src/order.js","../src/index.js"],"sourcesContent":["\r\nexport default function _finally (Promise) {\r\n  if (Promise.prototype.finally) return\r\n  Promise.prototype.finally = function (fn) {\r\n    return this.then(\r\n      (value) => Promise.resolve(fn()).then(() => value),\r\n      (reason) => Promise.resolve(fn()).then(() => { throw reason })\r\n    )\r\n  }\r\n}\r\n","\r\nexport default function timeout (Promise) {\r\n  if (Promise.prototype.timeout) return\r\n  Promise.prototype.timeout = function (ms, error) {\r\n    return new Promise((resolve, reject) => {\r\n      var timeoutId = setTimeout(function () {\r\n        if (!error || typeof error === 'string') {\r\n          error = new Error(error || 'Timed out after ' + ms + ' ms')\r\n        }\r\n        reject(error)\r\n      }, ms)\r\n\r\n      this.then(function (value) {\r\n        clearTimeout(timeoutId)\r\n        resolve(value)\r\n      }, function (exception) {\r\n        clearTimeout(timeoutId)\r\n        reject(exception)\r\n      })\r\n    })\r\n  }\r\n}\r\n","export function forEach (arr, fn, start = 0) {\r\n  let i = start\r\n  let len = arr.length\r\n  while (i < len && arr[i] !== void 0) {\r\n    fn(arr[i], i++)\r\n  }\r\n  return i\r\n}\r\nexport function delayResolve (time, value) {\r\n  return new Promise((resolve) => {\r\n    setTimeout(() => {\r\n      resolve(value)\r\n    }, time)\r\n  })\r\n}\r\n\r\nexport function delayReject (time, reason) {\r\n  return new Promise((resolve, reject) => {\r\n    setTimeout(() => {\r\n      reject(reason)\r\n    }, time)\r\n  })\r\n}\r\n","\r\nimport { forEach } from './util'\r\n\r\nexport default function order (Promise) {\r\n  Promise.order = function (promises, onFulfilled, onRejected) {\r\n    return new Promise((resolve) => {\r\n      let len = promises.length\r\n      let arr = new Array(len)\r\n      let j = 0\r\n      for (let i = 0; i < len; i++) {\r\n        let item = promises[i]\r\n        item.then((value) => {\r\n          arr[i] = {\r\n            value,\r\n            state: 'fulfilled'\r\n          }\r\n        }, (reason) => {\r\n          arr[i] = {\r\n            reason,\r\n            state: 'rejected'\r\n          }\r\n        }).finally(() => {\r\n          j = forEach(arr, (v) => {\r\n            if (v.state === 'fulfilled') {\r\n              onFulfilled(v.value)\r\n            } else if (v.state === 'rejected') {\r\n              onRejected(v.reason)\r\n            }\r\n          }, j)\r\n          if (j === len) {\r\n            resolve(arr)\r\n          }\r\n        })\r\n      }\r\n    })\r\n  }\r\n}\r\n","import _finally from './proto/finally'\r\nimport timeout from './proto/timeout'\r\nimport order from './order'\r\nimport { delayResolve, delayReject, forEach } from './util'\r\n\r\n_finally(Promise)\r\ntimeout(Promise)\r\norder(Promise)\r\n\r\nfunction Promise () {\r\n  this._value = null\r\n  this._state = void 0\r\n  this.subs = []\r\n  this._init()\r\n}\r\n\r\nPromise.prototype._init = function () {\r\n  let Constructor = this.constructor\r\n  _finally(Constructor)\r\n  timeout(Constructor)\r\n  order(Constructor)\r\n}\r\n\r\nexport default {\r\n  delayResolve,\r\n  delayReject,\r\n  forEach\r\n}\r\n"],"names":["this","let","i","Promise"],"mappings":"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"}